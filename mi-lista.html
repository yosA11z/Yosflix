<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mi Lista - Yosflix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: hidden;
        }
        .focus-visible {
            outline: 3px solid #ef4444;
            outline-offset: 2px;
        }
        .pelicula-card.focused,
        .pelicula-card:focus {
            outline: 3px solid #ef4444; /* Borde rojo para el foco */
            outline-offset: 4px;
            transform: scale(1.05);
        }
        .pelicula-card img {
            height: 450px;
            border-radius: 0.5rem;
            object-fit: cover;
            width: 100%;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header
        class="fixed top-0 left-0 w-full z-50 bg-gradient-to-b from-black to-transparent py-4 px-8 flex items-center justify-between"
    >
        <div class="text-red-600 text-3xl font-bold rounded-md cursor-pointer select-none" onclick="location.href='yosflix.html'">Y</div>
        <div
            id="perfil-image"
            class="w-8 h-8 bg-blue-500 rounded-md cursor-pointer overflow-hidden"
            tabindex="0"
            title="Perfil"
            aria-label="Perfil"
        >
            <img
                src="perfil-imagen.jpg"
                alt="imagen de perfil"
                class="w-full h-full object-cover"
            />
        </div>
    </header>

    <main class="flex-grow pt-20 px-8 max-w-7xl mx-auto w-full">

        <h1 class="text-4xl font-bold mb-2 select-none">Tu lista</h1>
        <p class="text-gray-400 mb-8 select-none">Películas que agregaste a tu lista</p>

        <div id="mi-lista" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-4 gap-6">
        </div>

        <p id="no-items" class="mt-4 text-gray-400 text-center hidden select-none">Aún no has agregado películas a tu lista.</p>

    </main>

    <script src="peliculas.js"></script>

    <script>
        const miListaContainer = document.getElementById('mi-lista');
        const noItemsText = document.getElementById('no-items');
        let currentFocus = null;

        // Obtiene la lista guardada en localStorage (array de títulos o IDs)
        function obtenerMiLista() {
            try {
                const lista = JSON.parse(localStorage.getItem('miLista'));
                if (Array.isArray(lista)) return lista;
                return [];
            } catch {
                return [];
            }
        }

        // Renderiza las películas que estén en mi lista
        function renderMiLista() {
            const listaTitulos = obtenerMiLista();
            miListaContainer.innerHTML = '';

            if (listaTitulos.length === 0) {
                noItemsText.classList.remove('hidden');
                return;
            }
            noItemsText.classList.add('hidden');

            const peliculasEnLista = window.peliculas.filter(peli => listaTitulos.includes(peli.titulo));

            if (peliculasEnLista.length === 0) {
                noItemsText.textContent = 'No se encontraron películas en tu lista.';
                noItemsText.classList.remove('hidden');
                return;
            }

            peliculasEnLista.forEach(peli => {
                const card = document.createElement('a');
                card.href = `detalles.html?titulo=${encodeURIComponent(peli.titulo)}`;
                card.className = "pelicula-card relative rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition-transform duration-300 shadow-lg focus-visible";
                card.tabIndex = 0;
                card.setAttribute('aria-label', `Ver detalles de ${peli.titulo}`);

                card.innerHTML = `
                    <img src="${peli.miniatura}" alt="${peli.titulo}" class="w-full h-[450px] object-cover" />
                `;

                miListaContainer.appendChild(card);
            });
        }
        
        // Lógica para el foco del control remoto
        function setFocus(element) {
            if (currentFocus) {
                currentFocus.classList.remove('focused');
            }
            if (element) {
                element.classList.add('focused');
                element.focus();
                currentFocus = element;
            }
        }
        
        function findNextElement(direction) {
            const allCards = Array.from(document.querySelectorAll('.pelicula-card'));
            if (!currentFocus || allCards.length === 0) return null;

            const currentIndex = allCards.indexOf(currentFocus);
            let nextIndex = currentIndex;

            if (direction === 'right') {
                nextIndex = (currentIndex + 1) % allCards.length;
            } else if (direction === 'left') {
                nextIndex = (currentIndex - 1 + allCards.length) % allCards.length;
            } else if (direction === 'down') {
                const numCols = 4; // Asumiendo 4 columnas para pantallas grandes
                nextIndex = (currentIndex + numCols) % allCards.length;
            } else if (direction === 'up') {
                const numCols = 4;
                nextIndex = (currentIndex - numCols + allCards.length) % allCards.length;
            }
            return allCards[nextIndex];
        }

        document.addEventListener('keydown', (e) => {
            if (document.querySelectorAll('.pelicula-card').length === 0) return;
            
            if (e.key === 'ArrowUp' || e.key === 'Up') {
                e.preventDefault();
                const nextElement = findNextElement('up');
                if (nextElement) setFocus(nextElement);
            } else if (e.key === 'ArrowDown' || e.key === 'Down') {
                e.preventDefault();
                const nextElement = findNextElement('down');
                if (nextElement) setFocus(nextElement);
            } else if (e.key === 'ArrowLeft' || e.key === 'Left') {
                e.preventDefault();
                const nextElement = findNextElement('left');
                if (nextElement) setFocus(nextElement);
            } else if (e.key === 'ArrowRight' || e.key === 'Right') {
                e.preventDefault();
                const nextElement = findNextElement('right');
                if (nextElement) setFocus(nextElement);
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (currentFocus) currentFocus.click();
            } else if (e.key === 'Escape' || e.key === 'Backspace') {
                window.history.back();
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            renderMiLista();

            // Lógica para cargar la imagen de perfil
            const storedProfile = localStorage.getItem('selectedProfile');
            if (storedProfile) {
                const profile = JSON.parse(storedProfile);
                const perfilImageElement = document.getElementById('perfil-image');
                if (perfilImageElement) {
                    const imgElement = perfilImageElement.querySelector('img');
                    if (imgElement) {
                        imgElement.src = profile.image;
                    }
                }
            }

            // Foco inicial al cargar
            const firstCard = document.querySelector('.pelicula-card');
            if (firstCard) {
                setFocus(firstCard);
            }
        });
    </script>
</body>
</html>