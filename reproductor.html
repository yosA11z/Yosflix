<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reproductor - Yosflix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
    <style>
        .player-container {
            position: relative;
            width: 100%;
            height: 100vh;
            background-color: black;
            overflow: hidden;
        }

        .video-player {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .controls-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 25%, rgba(0, 0, 0, 0) 75%, rgba(0, 0, 0, 0.7) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .controls-overlay.visible {
            opacity: 1;
        }

        .top-controls {
            padding: 1rem 2rem;
            display: flex;
            justify-content: flex-start;
        }

        .main-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            padding: 2rem 0;
        }

        .bottom-controls {
            padding: 1rem 2rem;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background-color: #555;
            cursor: pointer;
            position: relative;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            height: 100%;
            background-color: #e50914;
            width: 0;
        }

        .control-button {
            background: rgba(45, 45, 45, 0.8);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2rem;
            transition: background-color 0.2s, transform 0.2s, box-shadow 0.2s;
        }

        .control-button:hover {
            background: rgba(65, 65, 65, 0.9);
            transform: scale(1.1);
        }

        .back-button {
            background: transparent;
            font-size: 2.5rem;
            padding: 0.5rem;
        }

        .back-button:hover {
            color: #e50914;
        }

        .focused {
            outline: 3px solid #ef4444;
            outline-offset: 4px;
            box-shadow: 0 0 10px #ef4444;
            transform: scale(1.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
    </style>
</head>
<body class="bg-black text-white flex items-center justify-center h-screen overflow-hidden">

    <div class="player-container">
        <video id="video-player" class="video-player" playsinline></video>

        <div id="controls-overlay" class="controls-overlay">
            <div class="top-controls">
                <button id="back-button" class="back-button text-white nav-item" tabindex="0">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="main-controls">
                <button id="rewind-button" class="control-button nav-item" tabindex="0">
                    <i class="fas fa-undo"></i>
                </button>
                <button id="play-pause-button" class="control-button nav-item" tabindex="0">
                    <i id="play-pause-icon" class="fas fa-play"></i>
                </button>
                <button id="forward-button" class="control-button nav-item" tabindex="0">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
            <div class="bottom-controls">
                <div id="progress-bar-container" class="progress-bar-container">
                    <div id="progress-bar" class="progress-bar"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const videoPlayer = document.getElementById('video-player');
            const controlsOverlay = document.getElementById('controls-overlay');
            const playPauseButton = document.getElementById('play-pause-button');
            const playPauseIcon = document.getElementById('play-pause-icon');
            const rewindButton = document.getElementById('rewind-button');
            const forwardButton = document.getElementById('forward-button');
            const backButton = document.getElementById('back-button');
            const progressBar = document.getElementById('progress-bar');
            
            let currentFocusIndex = 0;
            const navItems = [backButton, rewindButton, playPauseButton, forwardButton];
            let controlsTimeout = null;

            // Función para mostrar los controles y ocultarlos después de 3 segundos
            function showControls() {
                controlsOverlay.classList.add('visible');
                clearTimeout(controlsTimeout);
                controlsTimeout = setTimeout(() => {
                    if (!videoPlayer.paused) {
                        controlsOverlay.classList.remove('visible');
                    }
                }, 3000);
            }

            // Lógica del foco con control remoto
            function setFocus(index) {
                if (navItems.length === 0) return;
                navItems.forEach(item => item.classList.remove('focused'));
                const newIndex = (index < 0) ? navItems.length - 1 : (index >= navItems.length) ? 0 : index;
                navItems[newIndex].classList.add('focused');
                navItems[newIndex].focus();
                currentFocusIndex = newIndex;
                showControls();
            }

            // Lógica para reproducir/pausar
            function togglePlayPause() {
                if (videoPlayer.paused || videoPlayer.ended) {
                    videoPlayer.play();
                    playPauseIcon.classList.remove('fa-play');
                    playPauseIcon.classList.add('fa-pause');
                } else {
                    videoPlayer.pause();
                    playPauseIcon.classList.remove('fa-pause');
                    playPauseIcon.classList.add('fa-play');
                }
                showControls();
            }

            // Lógica para adelantar/retroceder
            function rewind() {
                videoPlayer.currentTime -= 10;
                showControls();
            }

            function forward() {
                videoPlayer.currentTime += 10;
                showControls();
            }

            // Actualizar la barra de progreso
            videoPlayer.addEventListener('timeupdate', () => {
                const progress = (videoPlayer.currentTime / videoPlayer.duration) * 100;
                progressBar.style.width = `${progress}%`;
            });

            // Ocultar controles al hacer clic en el video
            videoPlayer.addEventListener('click', togglePlayPause);
            
            // Mostrar controles al mover el ratón o presionar una tecla
            document.addEventListener('mousemove', showControls);
            document.addEventListener('keydown', showControls);
            
            // Asignar eventos a los botones
            playPauseButton.addEventListener('click', togglePlayPause);
            rewindButton.addEventListener('click', rewind);
            forwardButton.addEventListener('click', forward);
            backButton.addEventListener('click', () => window.history.back());

            // --- Lógica del control remoto (keydown) ---
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft' || e.key === 'Left') {
                    e.preventDefault();
                    if (videoPlayer.paused) {
                        setFocus(currentFocusIndex - 1);
                    } else {
                        rewind();
                    }
                } else if (e.key === 'ArrowRight' || e.key === 'Right') {
                    e.preventDefault();
                    if (videoPlayer.paused) {
                        setFocus(currentFocusIndex + 1);
                    } else {
                        forward();
                    }
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (document.activeElement.tagName === 'BUTTON') {
                         document.activeElement.click();
                    } else {
                        togglePlayPause();
                    }
                } else if (e.key === 'Escape' || e.key === 'Backspace') {
                    window.history.back();
                } else if (e.key === ' ' || e.key === 'Spacebar') {
                    e.preventDefault();
                    togglePlayPause();
                }
            });

            // Extraer el enlace de la URL y reproducir el video
            const params = new URLSearchParams(window.location.search);
            const videoLink = params.get('video');
            if (videoLink) {
                videoPlayer.src = videoLink;
                videoPlayer.play().catch(e => console.error('Error al reproducir:', e));
            } else {
                console.error('No se encontró el enlace del video en la URL.');
            }

            // Foco inicial al cargar
            setFocus(2); // Inicia el foco en el botón de Play
        });
    </script>
</body>
</html>